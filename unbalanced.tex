
\section{Unbalanced Shifts}

\label{sec:Unbalanced-Shift}

\prettyref{sec:complexity} shows that \prettyref{alg:mab} can efficiently
compute a $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis when the
shift $\vec{s}$ is balanced. When the $\vec{s}$ is unbalanced (something
important for example in normal form computation \citep{BLV:1999,BLV:jsc06}),
then \prettyref{alg:mab} still returns a correct answer but may be
less efficient. The possible inefficiency results because there may
not be enough partial results from the intermediate subproblems to
sufficiently reduce the column dimension of the subsequent subproblem.
This is clear from the fact that the column degrees of the output
can be much larger and no longer sum up to $O\left(m\sigma\right)$
as in the balanced shift case. The shifted $\vec{s}$-column degrees,
however, still behave well. In particular, the total $\vec{s}$-degree
increase is still bounded by $m\sigma$ as stated in \prettyref{lem:size},
while the shifted degree of any column can also increase by up to
$\sigma$. Recall that \prettyref{lem:size} states that for any shift
$\vec{s}$, there exists a $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis
still having a total size bounded by $nm\sigma$ which gives hope
for efficient computation.

In this section, we describe an algorithm for an important special
case of unbalanced shift -- when the input shift $\vec{s}$ satisfies
the condition:\[
\sum_{i=1}^{n}(\max(\vec{s})-\vec{s}_{i})\le m\sigma.\]
 For simpler presentation, we use the equivalent condition \begin{equation}
\vec{s}\le0\mbox{ and }\sum_{i}-\vec{s}_{i}\le m\sigma,\label{con:unbalancedCondition}\end{equation}
 which can always be obtained from the previous condition by using
$\vec{s}-\max\vec{s}$ as the new shift. Note that translating every
entry of the shift by the same constant does not change the problem.

In the balanced shift case, a central problem is to find a way to
handle unbalanced column degrees of the output order basis. In this
section, the unbalanced shift makes row degrees of the output also
unbalanced, which is a major problem that needs to be resolved. Here
we note a second transformation by \citet{Storjohann:2006} which
converts the input in such a way that each high degree row of the
output becomes multiple rows of lower degrees. We refer to this as
Storjohann's second transformation to distinguish it from that described
in \prettyref{sub:storjohannTransformation}. The transformed problem
can then be computed efficiently using \prettyref{alg:mab}. After
the computation, rows can then be combined appropriately to form a
basis of the original problem. The method is computationally efficient.

Unfortunately, the bases computed this way are not minimal and hence
do not in general produce our reduced order bases. In the following,
we describe a transformation that incorporates Storjohann's second
transformation and guarantees the minimality of some columns of the
output, hence providing a partial order basis. We can then work on
the remaining columns iteratively as done in the balanced shift case
to compute a full order basis.

Condition \eqref{con:unbalancedCondition} essentially allows us to
locate the potential high degree rows that need to be balanced. In
more general cases, we may not know in advance which are the high
degree rows that need to be balanced, so our approach given in this
section does not work directly. This suggests that one possible future
direction to pursue is to find an effective way to estimate the row
degree of the result pivot entries. Such an estimate may allow us
to apply the method given in this section efficiently for general
unbalanced shifts. 


\subsection{Transform to Balanced Shifts}

We now describe the transformation for balancing the high degree rows
of the resulting basis. Consider the problem of computing a $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis,
where the input shift $\vec{s}$ satisfies the conditions \eqref{con:unbalancedCondition}.
Let $\alpha,\beta\in\mathbb{Z}_{>0}$ be two parameters. For each
shift entry $s_{i}$ in $\vec{s}$ with $-s_{i}>\alpha+\beta$, let
\[
r_{i}=\mbox{rem}\left(-s_{i}-\alpha-1,\beta\right)+1\]
 be the remainder when $-s_{i}-\alpha$ is divided by $\beta$, and
where $r_{i}=\beta$ in the case where the remainder is $0$, and
set \[
q_{i}=\begin{cases}
1 & \mbox{if }-s_{i}\le\alpha+\beta\\
1+\left(-s_{i}-\alpha-r_{i}\right)/\beta & \mbox{otherwise}\end{cases}\]
 Then, for each $q_{i}>1$, we expand the corresponding $i$th column
$\mathbf{f}_{i}$ of $\mathbf{F}$ and shift $s_{i}$ to \begin{eqnarray*}
\tilde{\mathbf{F}}^{\left(i\right)} & = & \left[~\mathbf{f}_{i},~x^{r_{i}}\mathbf{f}_{i},~x^{r_{i}+\beta}\mathbf{f}_{i},~\dots~,~x^{r_{i}+(q_{i}-2)\beta}\mathbf{f}_{i}\right],~~\tilde{s}_{i}=\left[-\alpha-\beta,~\dots~,-\alpha-\beta\right]\end{eqnarray*}
 with $q_{i}$ entries in each case. When $q_{i}=1$, the corresponding
shift entry and input column remain the same, that is, $\tilde{s}_{i}=s_{i}$,
and $\tilde{\mathbf{F}}^{\left(i\right)}=\mathbf{f}_{i}$. Then for
the transformed problem, the new shift becomes $\bar{s}=[\tilde{s}_{1},\dots,\tilde{s}_{n}]\in\mathbb{Z}_{\le0}^{\bar{n}}$,
and the new input matrix becomes $\bar{\mathbf{F}}=[\tilde{\mathbf{F}}^{\left(1\right)},\dots,\tilde{\mathbf{F}}^{\left(n\right)}]\in\mathbb{K}\left[x\right]^{m\times\bar{n}}$,
with the new column dimension $\bar{n}$ satisfies $\bar{n}=\sum_{i=1}^{n}q_{i}$.
Note that every entry of the new shift $\bar{s}$ is an integer from
$-\alpha-\beta$ to $0$. Let \[
\mathbf{E}=\left[\begin{array}{ccccc|ccc|ccccccc}
1 & x^{r_{1}} & x^{r_{1}+\beta} & \cdots & x^{r_{1}+(q_{1}-2)\beta} &  &  & \\
\hline  &  &  &  &  & \ddots &  & \\
 &  &  &  &  &  & \  & \ddots\\
\hline  &  &  &  &  &  &  &  & 1 & x^{r_{n}} & x^{r_{n}+\beta} & \cdots & x^{r_{n}+(q_{n}-2)\beta}\end{array}\right]_{n\times\bar{n}}.\]
 Then $\bar{\mathbf{F}}=\mathbf{F}\mathbf{E}$. Storjohann's second
transformation is determined by setting $\alpha=-1$, a value not
allowed in our transformation (we show later in \prettyref{thm:correctHighDegreeElements}
that this value is not useful in our case). One can verify that the
new dimension \[
\bar{n}=\sum_{i=1}^{n}q_{i}\le n+\sum_{i=1}^{n}-s_{i}/\beta\le m\sigma/\beta+n.\]
 Thus by setting $\beta\in\Theta\left(m\sigma/n\right)=\Theta\left(d\right)$,
we can make $\bar{n}\in\Theta\left(n\right)$. Furthermore, by also
setting $\alpha\in\Theta\left(d\right)$, we have a balanced shift
problem since \[
\max\bar{s}-\min\bar{s}\le-\min\bar{s}\le\alpha+\beta\in\Theta(d).\]
 Hence \prettyref{alg:mab} can compute a $\left(\bar{\mathbf{F}},\sigma,\bar{s}\right)$-basis
with cost $O^{\sim}\left(n^{\omega}d\right)$ in this case.

With a $\left(\bar{\mathbf{F}},\sigma,\bar{s}\right)$-basis $\bar{\mathbf{P}}\in\mathbb{K}\left[x\right]^{\bar{n}\times\bar{n}}$
computed, let us now consider $\mathbf{E}\bar{\mathbf{P}}\in\mathbb{K}\left[x\right]^{n\times\bar{n}}$.
While it is easy to see that $\mathbf{E}\bar{\mathbf{P}}$ has order
$\left(\mathbf{F},\sigma\right)$ since \textbf{$\mathbf{F}\mathbf{E}\bar{\mathbf{P}}=\bar{\mathbf{F}}\bar{\mathbf{P}}\equiv0\mod x^{\sigma}$},
in general it is not a minimal basis (in fact, $\mathbf{E}\bar{\mathbf{P}}$
is not even square). However, our transformation does guarantee that
the highest degree columns of $\mathbf{E}\bar{\mathbf{P}}$ having
$\vec{s}$-degrees exceed $-\alpha$ are minimal. That is, the columns
of $\mathbf{E}\bar{\mathbf{P}}$ whose $\vec{s}$-degrees exceed $-\alpha$
are exactly the columns of a $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis
whose $\vec{s}$-degrees exceed $-\alpha$. We have therefore correctly
computed a partial $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis. 
\begin{exmp}
\label{exm:unbalancedShift} Let us use the same input as in \prettyref{exm:StorjohannTransformation},
but with shift $\vec{s}=[0,-3,-5,-6]$, and parameters $\alpha=\beta=1$.
Then we get the transformed input \begin{align*}
\bar{\mathbf{F}}=[ & x+x^{2}+x^{3}+x^{4}+x^{5}+x^{6},\,~1+x+x^{5}+x^{6}+x^{7},\,~x+x^{2}+x^{6}+x^{7}+x^{8},\\
 & 1+x^{2}+x^{4}+x^{5}+x^{6}+x^{7},\,~x+x^{3}+x^{5}+x^{6}+x^{7}+x^{8},\,~x^{2}+x^{4}+x^{6}+x^{7}+x^{8}+x^{9},\\
 & x^{3}+x^{5}+x^{7}+x^{8}+x^{9}+x^{10},\,~1+x+x^{3}+x^{7},\,~x+x^{2}+x^{4}+x^{8},\\
 & x^{2}+x^{3}+x^{5}+x^{9},\,~x^{3}+x^{4}+x^{6}+x^{10},\,~x^{4}+x^{5}+x^{7}+x^{11}]\end{align*}
 having $12$ components, and $\bar{s}=[0,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2]$.
In this case $r_{1}=r_{2}=r_{3}=r_{4}=1$, $q_{1}=1$, $q_{2}=2$,
$q_{3}=4$, $q_{4}=5$ and the transformation matrix is \[
\mathbf{E}=\left[{\begin{array}{c|cc|cccc|ccccc}
~1~ & ~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~0~\\
\hline 0 & 1 & x & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
\hline 0 & 0 & 0 & 1 & x & x^{2} & x^{3} & 0 & 0 & 0 & 0 & 0\\
\hline 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & x & x^{2} & x^{3} & x^{4}\end{array}}\right].\]
 Using the earlier algorithm for balanced shift, we compute a $(\bar{\mathbf{F}},8,\bar{s})$-basis
\[
\bar{\mathbf{P}}=\left[{\begin{array}{cccccccccccc}
0 & ~0~ & ~0~ & ~0~ & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1\\
\hline ~x~ & 1 & 0 & 0 & 1 & 0 & ~x~ & 0 & 0 & 0 & ~x~ & ~0~\\
0 & 0 & 1 & 0 & 0 & ~x~ & 1+~x~ & ~x~ & ~x~ & ~x~ & 1 & 0\\
\hline ~x~ & 1 & 0 & 1 & 1+x & 1 & ~x~ & 0 & 0 & 0 & 0 & 1\\
~x~ & 0 & 1 & 1 & 1+x & 1+x & 1 & ~x~ & ~x~ & 0 & 0 & 0\\
~x~ & 0 & 0 & 1 & 1+x & 1+x & 1 & ~x~ & 0 & 1 & 0 & 0\\
~x~ & 0 & 0 & 1 & 1 & 0 & 0 & 1 & 0 & 0 & 0 & 0\\
\hline 0 & 0 & 0 & 1 & ~x~ & 1 & 0 & 0 & 0 & 0 & 0 & 1\\
0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
0 & 0 & 0 & 1 & 0 & ~x~ & 1 & 1 & 1 & 1 & 0 & 0\\
0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\end{array}}\right]\]
 with $\bar{s}$-degrees $[-1,-2,-2,-2,-1,-1,-1,-1,-1,-1,-1,0]$.
Only the last column has $\bar{s}$-degree exceeding $-\alpha=-1$
and so is the only column guaranteed to give a correct $(\mathbf{F},8,\vec{s})$-basis
element. Comparing \[
\mathbf{E}\bar{\mathbf{P}}=\left[{\begin{array}{cccccccccccc}
0 & ~0~ & ~0~ & 0 & ~0~ & 0 & ~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~1~\\
x & 1 & x & 0 & 1 & x^{2} & x^{2} & x^{2} & x^{2} & x^{2} & 0 & 0\\
x+x^{2}+x^{3}+x^{4} & 1 & x & 1+x+x^{2}+x^{3} & 1 & 1+x+x^{3} & x^{2} & x^{2} & x^{2} & x^{2} & 0 & 1\\
0 & x & x^{2} & 1+x^{3}+x^{4} & x & 1+x^{4} & x^{3} & x^{3} & x^{3} & x^{3} & 0 & 1\end{array}}\right]\]
 to a $(\mathbf{F},8,\vec{s})$-basis \[
\mathbf{P}=\left[{\begin{array}{cccc}
~0~ & 0 & 0 & ~1~\\
1 & 0 & 0 & 0\\
1 & x^{2}+x^{3}+x^{4} & 1+x+x^{2}+x^{3} & 1\\
x & x^{2} & 1+x^{3}+x^{4} & 1\end{array}}\right]\]
 with $\vec{s}$-degrees $[-3,-1,-2,~0~]$, we see that the last column
of $\mathbf{E}\bar{\mathbf{P}}$ is a element of a $(\mathbf{F},8,\vec{s})$-basis.

If we set $\alpha=2,\beta=1$, then the new transformed problem gives
\[
\bar{\mathbf{P}}=\left[{\begin{array}{ccccccccc}
~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~1~\\
1 & 0 & 0 & x & 1+x & x & x & \, x\, & \,0\,\\
1 & x^{2} & 1 & x & 1 & x & \, x\, & 0 & 1\\
0 & x^{2} & 1 & \, x\, & 1 & \, x\, & 0 & 1 & 0\\
0 & x^{2} & 1+x & 1 & 0 & 1 & 0 & 0 & 0\\
0 & x^{2} & 1 & 0 & \, x\, & 0 & 0 & 0 & 1\\
1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
\,0\, & \,0\, & \, x\, & 1+x & 1 & 1 & 1 & 1 & 0\\
0 & 0 & x & 1 & 0 & 0 & 0 & 0 & 0\end{array}}\right]\]
 with $\bar{s}$-degrees $[-3,-1,-2,-2,-2,-2,-2,-2,~0~]$. In this
case the second column also has $\bar{s}$-degree exceeding $-\alpha=-2$,
and so it is guaranteed to produce another element of a $(\mathbf{F},8,\vec{s})$-basis.
Computing \[
\mathbf{E}\bar{\mathbf{P}}=\left[{\begin{array}{ccccccccc}
~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~0~ & ~1~\\
1 & 0 & 0 & x & 1+x & x & x & x & 0\\
1 & x^{2}+x^{3}+x^{4} & 1+x+x^{2}+x^{3} & x & 1+x & x & x & x & 1\\
x & x^{2} & 1+x^{3}+x^{4} & x^{2} & x+x^{2} & ~x^{2} & ~x^{2} & ~x^{2} & 1\end{array}}\right],\]
 we notice the second column is indeed an element of a $(\mathbf{F},8,\vec{s})$-basis. 
\end{exmp}

\subsection{Correspondence Between the Original Problem and the Transformed Problem}

We now work towards establishing the correspondence between the high
degree columns of a $\left(\bar{\mathbf{F}},\sigma,\bar{s}\right)$-basis
whose $\bar{s}$-degrees exceed $-\alpha$ and those of a $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis
whose $\vec{s}$-degrees exceed $-\alpha$. A useful link is provided
by the following a matrix .

Set \[
\mathbf{A}_{i}=\begin{bmatrix}~~x^{r_{i}}\\
-1 & ~~x^{\beta}\\
 & -1 & \ddots\\
 &  & \ddots & ~~x^{\beta}\\
 &  &  & -1\end{bmatrix}_{q_{i}\times(q_{i}-1)}\mbox{ and \qquad}\mathbf{A}=\left[\begin{array}{ccc}
\mathbf{A}_{1}\\
 & \ddots\\
 &  & \mathbf{A}_{n}\end{array}\right]_{\bar{n}\times(\bar{n}-n)}.\]
 If $q_{i}=1$, $\mathbf{A}_{i}$ has dimension $1\times0$, which
just adds a zero row and no column in $\mathbf{A}$.

We now show that for any $\bar{\mathbf{w}}\in\left\langle \left(\bar{\mathbf{F}},\sigma,\bar{s}\right)\right\rangle $,
$\bar{\mathbf{w}}$ can be transformed by $\mathbf{A}$ to one of
the two forms that correspond to the original problem and transformed
problem. This is made more precise in the following lemma. We then
use unimodular equivalence of these two forms to show the equivalence
between the high degree part of the result from the transformed problem
and that of the original problem. 
\begin{lem}
Let \[
\bar{\mathbf{w}}=\begin{bmatrix}\bar{\mathbf{w}}_{1}\\
\vdots\\
\bar{\mathbf{w}}_{n}\end{bmatrix}\in\langle(\bar{\mathbf{F}},\sigma,\bar{s})\rangle\mbox{ with }\bar{\mathbf{w}}_{i}=\begin{bmatrix}\bar{w}_{i,0}\\
\vdots\\
\bar{w}_{i,q_{i}-1}\end{bmatrix}_{q_{i}\times1}.\]
 Then there exists a vector $\mathbf{u}\in\mathbb{K}\left[x\right]^{\left(\bar{n}-n\right)\times1}$
such that $\bar{\mathbf{w}}+\mathbf{A}\mathbf{u}$ has one of the
following two forms. 
\begin{description}
\item [{{{{(a)}}}}] The first form is \textup{\[
\mathbf{w}^{[1]}=\begin{bmatrix}\mathbf{w}_{1}^{[1]}\\
\vdots\\
\mathbf{w}_{n}^{[1]}\end{bmatrix}\mbox{ with }\mathbf{w}_{i}^{[1]}=\begin{bmatrix}w_{i}\\
0\\
\vdots\\
0\end{bmatrix}_{q_{i}\times1},\]
 } where \textup{$w_{i}=\bar{w}_{i,0}+\bar{w}_{i,1}x^{r_{i}}+\bar{w}_{i,2}x^{r_{i}+\beta}+\cdots+\bar{w}_{i,q_{i}-1}x^{r_{i}+(q_{i}-2)\beta}$.} 
\item [{{{{(b)}}}}] The second form is \[
\mathbf{w}^{[2]}=\begin{bmatrix}\mathbf{w}_{1}^{[2]}\\
\vdots\\
\mathbf{w}_{n}^{[2]}\end{bmatrix}\mbox{ with }\mathbf{w}_{i}^{[2]}=\begin{bmatrix}w_{i,0}\\
\vdots\\
w_{i,q_{i}-1}\end{bmatrix},\]
 where $\deg w_{i,j}<r_{i}\le\beta$ when $j=0$ and $\deg w_{i,j}<\beta$
when $j\in\{1,\dots,q_{i}-2\}$. There is no degree restriction on
$w_{i,q_{i}-1}$. 
\end{description}
\end{lem}
\begin{pf}
The first form is obtained by setting \[
\mathbf{u}^{[1]}=\begin{bmatrix}\mathbf{u}_{1}^{[1]}\\
\vdots\\
\mathbf{u}_{n}^{[1]}\end{bmatrix}\mbox{ with }\mathbf{u}_{i}^{[1]}=\left[\begin{array}{r}
\bar{w}_{i,1}+\bar{w}_{i,2}x^{\beta}+\bar{w}_{i,3}x^{2\beta}+\cdots+\bar{w}_{i,q_{i}-1}x^{(q_{i}-2)\beta}\\
\bar{w}_{i,2}+\bar{w}_{i,3}x^{\beta}+\cdots+\bar{w}_{i,q_{i}-1}x^{(q_{i}-3)\beta}\\
\vdots~~~~~\\
\bar{w}_{i,q_{i}-1}\end{array}\right].\]
 Then $\bar{\mathbf{w}}+\mathbf{A}\mathbf{u}^{[1]}$ gives the first
form. Note that $\mathbf{u}_{i}^{[1]}$ is empty if $q_{i}=1$ and
$\bar{\mathbf{w}}_{i}=\mathbf{w}_{i}^{[1]}=[\bar{w}_{i,0}]$ is not
changed by the transformation.

The second form can be obtained based on the first form. Let \[
t_{i,j}=\begin{cases}
r_{i} & \mbox{if }j=0\\
\beta & \mbox{if }j\in\{1,\dots,q_{i}-2\}\end{cases}\]
 and write $w_{i}$ from the first form as \begin{equation}
w_{i}=w_{i,0}+w_{i,1}x^{r_{i}}+w_{i,2}x^{r_{i}+\beta}+\cdots+w_{i,q_{i}-1}x^{r_{i}+(q_{i}-2)\beta}\label{eq:wiSeparatedForm}\end{equation}
 with $\deg w_{i,j}<t_{i,j}$ for $j<q_{i}-1$. Note that in general
$w_{i,j}\ne\bar{w}_{i,j}$, as $\deg\bar{w}_{i,j}$ may not be less
than $t_{i,j}$. Now set \[
\mathbf{v}=\begin{bmatrix}\mathbf{v}_{1}\\
\vdots\\
\mathbf{v}_{n}\end{bmatrix}\mbox{ with }\mathbf{v}_{i}=\left[\begin{array}{r}
w_{i,1}+w_{i,2}x^{\beta}+w_{i,3}x^{2\beta}+\cdots+w_{i,q_{i}-1}x^{(q_{i}-2)\beta}\\
w_{i,2}+w_{i,3}x^{\beta}+\cdots+w_{i,q_{i}-1}x^{(q_{i}-3)\beta}\\
\vdots~~~~~\\
w_{i,q_{i}-1}\end{array}\right]\]
 and $\mathbf{u}^{[2]}=\mathbf{u}^{[1]}-\mathbf{v}$, which comes
from the unimodular transformation \[
\left[\bar{\mathbf{w}},\mathbf{A}\right]\left[\begin{array}{c|c}
1\\
\hline \mathbf{\mathbf{u}}^{[1]} & \mathbf{I}\end{array}\right]\left[\begin{array}{c|c}
1\\
\hline -\mathbf{v} & \mathbf{I}\end{array}\right]=\left[\bar{\mathbf{w}},\mathbf{A}\right]\left[\begin{array}{c|c}
1\\
\hline \mathbf{u}^{[1]}-\mathbf{v} & \mathbf{I}\end{array}\right].\]
 Then $\mathbf{w}^{[2]}=\bar{\mathbf{w}}+\mathbf{A}\mathbf{u}^{[2]}$
is in the second form. Again note that $\mathbf{v}_{i}$ and $\mathbf{u}_{i}^{[2]}$
are empty if $q_{i}=1$ and $\mathbf{w}_{i}^{[2]}=\bar{\mathbf{w}}_{i}=[\bar{w}_{i,0}]$.\end{pf}
\begin{lem}
\label{lem:degreeCorrespondence}Let $\bar{\mathbf{w}}\in\left\langle \left(\bar{\mathbf{F}},\sigma,\bar{s}\right)\right\rangle $
and $\mathbf{w}^{[2]}$ be in the second form. If $\deg_{\vec{s}}\mathbf{E}\bar{\mathbf{w}}>-\alpha$
or $\deg_{\bar{s}}\mathbf{w}^{[2]}>-\alpha$, then $\deg_{\vec{s}}\mathbf{E}\bar{\mathbf{w}}=\deg_{\bar{s}}\mathbf{w}^{[2]}$. \end{lem}
\begin{pf}
Consider the $i$th entry $w_{i}$ of $\mathbf{E}\bar{\mathbf{w}}$
and the %corresponding 
entries $\mathbf{w}_{i}^{[2]}=\left[w_{i,0},\dots,w_{i,q_{i}-1}\right]^{T}$
in $\mathbf{w}^{[2]}$. If $q_{i}=1$, then $w_{i}=w_{i,0}$ and the
corresponding shifts satisfies $s_{i}=\bar{s}_{\ell(i)}$, where $\ell(i)=\sum_{k=1}^{i}q_{k}$.
Hence $\deg w_{i}+s_{i}=\deg w_{i,0}+\bar{s}_{\ell(i)}$. Thus we
only need to consider the case where $q_{i}>1$. Write $w_{i}$ as
in Equation \prettyref{eq:wiSeparatedForm}. Note that $\deg w_{i,q_{i}-1}=\deg w_{i}-r_{i}-\beta\left(q_{i}-2\right)$
and hence $\deg w_{i,q_{i}-1}-\alpha-\beta=\deg w_{i}-r_{i}-\alpha-\beta\left(q_{i}-1\right)$,
that is, $\deg w_{i,q_{i}-1}+\bar{s}_{\ell(i)}=\deg w_{i}+s_{i}$.
It follows that \begin{eqnarray*}
\deg_{\vec{s}}\mathbf{E}\bar{\mathbf{w}} & = & \max_{i}(\deg w_{i}+s_{i})=\max_{i}(\deg w_{i,q_{i}-1}+\bar{s}_{\ell(i)})\\
 & \le & \max_{i,j}\left(\deg w_{i,j}+\bar{s}_{\ell(i-1)+j+1}\right)=\deg_{\bar{s}}\mathbf{w}^{[2]}.\end{eqnarray*}
 The only possible indices $j$ where the inequality can be strict
occur when $j<q_{i}-1$. But $\deg w_{i,j}<\beta$ for all $j<q_{i}-1$,
which implies $\deg w_{i,j}+\bar{s}_{\ell(i-1)+j+1}=\deg w_{i,j}-\alpha-\beta<-\alpha$,
and so it follows that the entries at these indices $j$ do not contribute
to $\deg_{\bar{s}}\mathbf{w}^{[2]}$ when $\deg_{\bar{s}}\mathbf{w}^{[2]}>-\alpha$
or $\deg_{\vec{s}}\mathbf{E}\bar{\mathbf{w}}=\max_{i}(\deg w_{i,q_{i}-1}+\bar{s}_{\ell(i)})>-\alpha$.
In other words, if one of them exceeds $-\alpha$, then $\deg_{\bar{s}}\mathbf{w}^{[2]}$
and $\deg_{\vec{s}}\mathbf{E}\bar{\mathbf{w}}$ are determined only
by entries at indices $j=q_{i}-1$, but the equality always holds
for these entries. \end{pf}
\begin{rem}
Notice that the first form $\mathbf{w}^{\left[1\right]}$ of $\bar{\mathbf{w}}$
has nonzero entries only at indices $I=[1,q_{1}+1,\dots,\sum_{k=1}^{n-1}q_{k}+1]$.
Let $\mathbf{B}$ be a $\bar{n}\times n$ matrix with $1$'s at position
$(\sum_{k=1}^{n-1}q_{k}+1,i)$ and 0's everywhere else. Then the first
form satisfies\textup{ $\mathbf{w}^{[1]}=\mathbf{B}\mathbf{E}\bar{\mathbf{w}}$.}
Hence \prettyref{lem:degreeCorrespondence} provides the degree correspondence
between the degrees of the first form $\mathbf{B}\mathbf{E}\bar{\mathbf{w}}$,
which is just $\mathbf{E}\bar{\mathbf{w}}$ with zero rows added,
and the second form $\bar{\mathbf{w}}^{[2]}$ of $\bar{\mathbf{w}}$.\end{rem}
\begin{cor}
\label{cor:degreeCorrespondence}Let $\bar{\mathbf{w}}\in\left\langle \left(\bar{\mathbf{F}},\sigma,\bar{s}\right)\right\rangle $
and $\mathbf{w}^{[2]}$ be its second form. Then $\deg_{\vec{s}}\mathbf{E}\bar{\mathbf{w}}>-\alpha$
if and only if $\deg_{\bar{s}}\mathbf{w}^{[2]}>-\alpha$.\end{cor}
\begin{pf}
The proof follows directly from \prettyref{lem:degreeCorrespondence}.\end{pf}
\begin{lem}
\label{lem:degEwLessEqDegw}Let $\bar{\mathbf{w}}\in\left\langle \left(\bar{\mathbf{F}},\sigma,\bar{s}\right)\right\rangle $.
Then $\deg_{\vec{s}}\mathbf{E}\bar{\mathbf{w}}\le\deg_{\bar{s}}\bar{\mathbf{w}}$. \end{lem}
\begin{pf}
As in \prettyref{lem:degreeCorrespondence}, consider the $i$th entry
$w_{i}$ of $\mathbf{E}\bar{\mathbf{w}}$ and the corresponding entries
$\bar{\mathbf{w}}_{i}=\left[\bar{w}_{i,0},\dots,\bar{w}_{i,q_{i}-1}\right]^{T}$
in $\bar{\mathbf{w}}$. If $q_{i}=1$, then $\deg w_{i}+s_{i}=\deg w_{i,0}+\bar{s}_{\ell(i)}$
as before. Thus we just need to consider the case $q_{i}>1$, where
the shifts for $\bar{\mathbf{w}}_{i}$ are $-\alpha-\beta$. Since
$w_{i}=\bar{w}_{i,0}+\bar{w}_{i,1}x^{r_{i}}+\bar{w}_{i,2}x^{r_{i}+\beta}+\cdots+\bar{w}_{i,q_{i}-1}x^{r_{i}+(q_{i}-2)\beta},$
we get \[
\deg w_{i}=\max\left\{ \deg\bar{w}_{i,0},\deg\bar{w}_{i,1}+r_{i},\deg\bar{w}_{i,2}+r_{i}+\beta,\dots,\deg\bar{w}_{i,q_{i}-2}+r_{i}+(q_{i}-2)\beta\right\} .\]
 Then \begin{eqnarray*}
\deg w_{i}+s_{i} & = & \deg w_{i}-r_{i}-\alpha-\beta(q_{i}-1)\\
 & = & \max\left\{ \deg\bar{w}_{i,0}-r_{i}-\alpha-\beta(q_{i}-1),~\deg\bar{w}_{i,1}-\alpha-\beta(q_{i}-1),~\dots,\right.\\
 &  & \left.~~~~~~~~~~~~~~\dots,\deg\bar{w}_{i,q_{i}-2}-\alpha-\beta\right\} \\
 & \le & \max\left\{ \deg\bar{w}_{i,0}-\alpha-\beta,\deg\bar{w}_{i,1}-\alpha-\beta,\dots,\deg\bar{w}_{i,q_{i}-2}-\alpha-\beta\right\} ,\end{eqnarray*}
 and so $\deg_{\vec{s}}\mathbf{E}\bar{\mathbf{w}}\le\deg_{\bar{s}}\bar{\mathbf{w}}$.\end{pf}
\begin{cor}
\label{cor:P2Degree}Let $\bar{\mathbf{P}}=[\bar{\mathbf{P}}_{1},\bar{\mathbf{P}}_{2}]$
be a $\left(\bar{\mathbf{F}},\sigma,\bar{s}\right)$-basis, where
$\deg_{\bar{s}}\bar{\mathbf{P}}_{1}\le-\alpha$ and $\deg_{\bar{s}}\bar{\mathbf{P}}_{2}>-\alpha$.
Let $\bar{\mathbf{P}}_{2}^{[2]}$ be the second form of $\bar{\mathbf{P}}_{2}$.
Then $\deg_{\bar{s}}\bar{\mathbf{P}}_{2}=\deg_{\bar{s}}\bar{\mathbf{P}}_{2}^{[2]}=\deg_{\vec{s}}\mathbf{E}\bar{\mathbf{P}}_{2}$.
Hence $[\bar{\mathbf{P}}_{1},\bar{\mathbf{P}}_{2}^{[2]}]$ is also
a $(\bar{\mathbf{F}},\sigma,\bar{s})$-basis.\end{cor}
\begin{pf}
Since any column $\bar{\mathbf{p}}$ of $\bar{\mathbf{P}}_{2}$ satisfies
$\deg_{\bar{s}}\bar{\mathbf{p}}>-\alpha,$ from \prettyref{lem:degreeCorrespondence}
and \prettyref{lem:degEwLessEqDegw}, we get \[
\deg_{\bar{s}}\bar{\mathbf{p}}^{[2]}=\deg_{\vec{s}}\mathbf{E}\bar{\mathbf{p}}\le\deg_{\bar{s}}\bar{\mathbf{p}}.\]
 The inequality is in fact an equality, since otherwise, $\bar{\mathbf{p}}$
in $\bar{\mathbf{P}}$ can be replaced by $\bar{\mathbf{p}}^{[2]}$
to get a basis of lower degree, contradicting the minimality of $\bar{\mathbf{P}}$.
Note that $\bar{\mathbf{P}}$ with its column $\bar{\mathbf{p}}$
replaced by $\bar{\mathbf{p}}^{[2]}$ remains to be a $\left(\bar{\mathbf{F}},\sigma,\bar{s}\right)$-basis,
since $\bar{\mathbf{p}}^{[2]}=\bar{\mathbf{p}}+\mathbf{A}\mathbf{u}$
involves column operations with only columns in $\bar{\mathbf{P}}_{1}$
as $\mathbf{A}$ has $\bar{s}$-degrees bounded by $-\alpha$ and
hence is generated by $\bar{\mathbf{P}}_{1}$.\end{pf}
\begin{lem}
\label{lem:PtoBPA}If $\mathbf{P}$ is a $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis,
then $\left[\mathbf{B}\mathbf{P},\mathbf{A}\right]$ is a basis for
$\left\langle \left(\bar{\mathbf{F}},\sigma,\bar{s}\right)\right\rangle $.\end{lem}
\begin{pf}
Any $\bar{\mathbf{w}}\in\left\langle \left(\bar{\mathbf{F}},\sigma,\bar{s}\right)\right\rangle $
can be transformed by $\mathbf{A}$ to the first form \[
\mathbf{w}^{[1]}=\bar{\mathbf{w}}+\mathbf{A}\mathbf{u}^{[1]}=\mathbf{B}\mathbf{E}\bar{\mathbf{w}},\]
 where $\mathbf{E}\bar{\mathbf{w}}\in\left\langle \left(\mathbf{F},\sigma,\vec{s}\right)\right\rangle $
is generated by $\mathbf{P}$. That is, \[
\bar{\mathbf{w}}=\mathbf{w}^{[1]}-\mathbf{A}\mathbf{u}^{[1]}=\mathbf{B}\mathbf{E}\bar{\mathbf{w}}-\mathbf{A}\mathbf{u}^{[1]}=\mathbf{B}\mathbf{P}\mathbf{v}-\mathbf{A}\mathbf{u}^{[1]}=\left[\mathbf{B}\mathbf{P},\mathbf{A}\right][\mathbf{v},-\mathbf{u}^{[1]}]^{T}.\]
 One can also see that the columns of $\mathbf{A}$ and the columns
of $\mathbf{B}\mathbf{P}$ are linearly independent, as each zero
row of $\mathbf{B}\mathbf{P}$ has a $-1$ from a column of $\mathbf{A}$. 
\end{pf}
%
\begin{comment}
\begin{lem}
If $\mathbf{P}_{1}$ is a $\left(\mathbf{F},\sigma,\vec{s}\right)_{-\alpha}$-basis
, then $\left[\mathbf{B}\mathbf{P}_{1},\mathbf{A}\right]$ is a basis
for $\left\langle \left(\bar{\mathbf{F}},\sigma,\bar{s}\right)\right\rangle _{-\alpha}$.\end{lem}
\begin{pf}
We know that if $\bar{\mathbf{w}}$ has order $\left(\bar{\mathbf{F}},\sigma\right)$
then $\mathbf{E}\bar{\mathbf{w}}$ has order $\left(\vec{\mathbf{F}},\sigma\right)$.
Also if $\deg_{\bar{s}}\bar{\mathbf{w}}\le-\alpha$, then $\deg_{\vec{s}}\mathbf{E}\bar{\mathbf{w}}\le-\alpha$
by \prettyref{lem:degEwLessEqDegw}. Therefore, if $\bar{\mathbf{w}}\in\left\langle \left(\bar{\mathbf{F}},\sigma,\bar{s}\right)\right\rangle _{-\alpha}$
, then $\mathbf{E}\bar{\mathbf{w}}\in\left\langle \left(\mathbf{F},\sigma,\vec{s}\right)\right\rangle _{-\alpha}$.
Now apply the same procedure as in \prettyref{lem:PtoBPA}, we get
$\bar{\mathbf{w}}=\mathbf{w}^{[1]}-\mathbf{A}\mathbf{u}^{[1]}=\mathbf{B}\mathbf{E}\bar{\mathbf{w}}-\mathbf{A}\mathbf{u}^{[1]}=\mathbf{B}\mathbf{P}_{1}\mathbf{v}-\mathbf{A}\mathbf{u}^{[1]}=\left[\mathbf{B}\mathbf{P}_{1},\mathbf{A}\right][\mathbf{v},-\mathbf{u}^{[1]}]^{T}.$
Also as before, the columns of $\mathbf{A}$ and the columns of $\mathbf{B}\mathbf{P}_{1}$
are linearly independent. 
\end{pf}

\end{comment}
{} 
\begin{lem}
\label{lem:EPgeneration}If $\bar{\mathbf{P}}$ is a $\left(\bar{\mathbf{F}},\sigma,\bar{s}\right)$-basis,
then $\mathbf{E}\bar{\mathbf{P}}$ generates $\left\langle \left(\mathbf{F},\sigma,\vec{s}\right)\right\rangle $.
That is, for any $\mathbf{w}\in\left\langle \left(\mathbf{F},\sigma,\vec{s}\right)\right\rangle $,
there is an $\mathbf{u}\in\mathbb{K}\left[x\right]^{\bar{n}\times1}$
such that $\mathbf{w}=\mathbf{E}\bar{\mathbf{P}}\mathbf{u}$.\end{lem}
\begin{pf}
For any $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis $\mathbf{P}$,
the columns of $\mathbf{B}\mathbf{P}$ are in $\langle(\bar{\mathbf{F}},\sigma,\bar{s})\rangle$
generated by $\bar{\mathbf{P}}$, that is, $\mathbf{B}\mathbf{P}=\bar{\mathbf{P}}\mathbf{U}$
for some $\mathbf{U}\in\mathbb{K}[x]^{\bar{n}\times n}$. Hence $\mathbf{E}\mathbf{B}\mathbf{P}=\mathbf{P}$
is generated by $\mathbf{E}\bar{\mathbf{P}}$. That is, $\mathbf{P}=\mathbf{E}\bar{\mathbf{P}}\mathbf{U}$.
Then any $\mathbf{w}\in\left\langle \left(\mathbf{F},\sigma,\vec{s}\right)\right\rangle $,
which satisfies $\mathbf{w}=\mathbf{P}\mathbf{v}$ for some $\mathbf{v}\in\mathbb{K}[x]^{n\times1}$,
satisfies $\mathbf{w}=\mathbf{E}\bar{\mathbf{P}}\mathbf{U}\mathbf{v}$. 
\end{pf}
%
\begin{comment}
\begin{lem}
\label{lem:EP1generation}If $\bar{\mathbf{P}}_{1}$ is a $\left(\bar{\mathbf{F}},\sigma,\bar{s}\right)_{-\alpha}$-basis,
then $\mathbf{E}\bar{\mathbf{P}}_{1}$ generates $\left\langle \left(\mathbf{F},\sigma,\vec{s}\right)\right\rangle _{-\alpha}$. \end{lem}
\begin{pf}
Suppose $\mathbf{P}_{1}$ is a $\left(\mathbf{F},\sigma,\vec{s}\right)_{-\alpha}$-basis,
then the columns of $\mathbf{B}\mathbf{P}_{1}$ can be transformed
to the second form with $\bar{s}$-degrees less than or equal to$-\alpha$
by \prettyref{cor:degreeCorrespondence}, hence generated by $\bar{\mathbf{P}}_{1}$.
That is, $\mathbf{B}\mathbf{P}_{1}+\mathbf{A}\mathbf{U}$ is generated
by $\bar{\mathbf{P}}_{1}$. Therefore, $\mathbf{E}(\mathbf{B}\mathbf{P}_{1}+\mathbf{A}\mathbf{U})=\mathbf{E}\mathbf{B}\mathbf{P}_{1}=\mathbf{P}_{1}$
is generated by $\mathbf{E}\bar{\mathbf{P}}_{1}$. 
\end{pf}

\end{comment}
{}

We are now ready to prove the main result on the correspondence between
a high degree part of a basis of the transformed problem and that
of the original problem. 
\begin{thm}
\label{thm:correctHighDegreeElements}Let $\bar{\mathbf{P}}=[\bar{\mathbf{P}}_{1},\bar{\mathbf{P}}_{2}]$
be a $\left(\bar{\mathbf{F}},\sigma,\bar{s}\right)$-basis, where
$\deg_{\bar{s}}\bar{\mathbf{P}}_{1}\le-\alpha$ and $\deg_{\bar{s}}\bar{\mathbf{P}}_{2}>-\alpha$.
Then $\mathbf{E}\bar{\mathbf{P}}_{2}$ is the matrix of the columns
of a $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis whose $\vec{s}$-degrees
exceed $-\alpha$. \end{thm}
\begin{pf}
We want to show that $[\mathbf{P}_{1},\mathbf{E}\bar{\mathbf{P}}_{2}]$
is a $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis for any $\left(\mathbf{F},\sigma,\vec{s}\right)_{-\alpha}$-basis
$\mathbf{P}_{1}$. First, $\mathbf{E}\bar{\mathbf{P}}$ has order
$(\mathbf{F},\sigma)$ since $\bar{\mathbf{F}}\bar{\mathbf{P}}=\mathbf{F}\mathbf{E}\bar{\mathbf{P}}$
and $\bar{\mathbf{P}}$ has order $\left(\bar{\mathbf{F}},\sigma\right)$.
Also, since $\mathbf{E}\bar{\mathbf{P}}$ generates $\left\langle \left(\mathbf{F},\sigma,\vec{s}\right)\right\rangle $
by \prettyref{lem:EPgeneration}, and from \prettyref{cor:degreeCorrespondence}
$\mathbf{E}\bar{\mathbf{P}}_{1}$ has $\vec{s}$-degree bounded by
$-\alpha$ hence is generated by $\mathbf{P}_{1}$, it follows that
$\left[\mathbf{P}_{1},\mathbf{E}\bar{\mathbf{P}}_{2}\right]$ generates
$\left\langle \left(\mathbf{F},\sigma,\vec{s}\right)\right\rangle $.

It only remains to show that the $\vec{s}$-degrees of $\mathbf{E}\bar{\mathbf{P}}_{2}$
are minimal. Suppose not, then $[\mathbf{P}_{1},\mathbf{E}\bar{\mathbf{P}}_{2}]$
can be reduced to $[\mathbf{P}_{1},\tilde{\mathbf{P}}_{2}]$ where
$\tilde{\mathbf{P}}_{2}$ has a column having lower $\vec{s}$-degree
than that of the corresponding column in $\mathbf{E}\bar{\mathbf{P}}_{2}$.
That is, assuming the columns of $\tilde{\mathbf{P}}_{2}$ and $\mathbf{E}\bar{\mathbf{P}}_{2}$
are in non-decreasing $\vec{s}$-degrees order, then we can find the
first index $i$ where the $\vec{s}$-degree of $i$th column of $\tilde{\mathbf{P}}_{2}$
is lower than the $\vec{s}$-degree of the $i$th column of $\mathbf{E}\bar{\mathbf{P}}_{2}$.
It follows that $[\mathbf{B}\mathbf{P}_{1},\mathbf{B}\mathbf{E}\bar{\mathbf{P}}_{2}]$
can be reduced to $[\mathbf{B}\mathbf{P}_{1},\mathbf{B}\tilde{\mathbf{P}}_{2}]$
and $[\mathbf{B}\mathbf{P}_{1},\mathbf{B}\mathbf{E}\bar{\mathbf{P}}_{2},\mathbf{A}]$
can be reduced to $[\mathbf{B}\mathbf{P}_{1},\mathbf{B}\tilde{\mathbf{P}}_{2},\mathbf{A}]$.
Since $[\mathbf{B}\mathbf{P}_{1},\mathbf{B}\tilde{\mathbf{P}}_{2},\mathbf{A}]$
generates $\langle(\bar{\mathbf{F}},\sigma,\bar{s})\rangle$ by \prettyref{lem:PtoBPA},
it can be reduced to $\bar{\mathbf{P}}=[\bar{\mathbf{P}}_{1},\bar{\mathbf{P}}_{2}]$.
But it can also be reduced to $[\bar{\mathbf{P}}_{1},\tilde{\mathbf{P}}_{2}^{[2]},\mathbf{A}]$
with $\tilde{\mathbf{P}}_{2}^{[2]}$ the second form of $\mathbf{B}\tilde{\mathbf{P}}_{2}$,
and to $[\bar{\mathbf{P}}_{1},\tilde{\mathbf{P}}_{2}^{[2]}]$ as the
columns of $\mathbf{A}$ are generated by the $\left(\bar{\mathbf{F}},\sigma,\bar{s}\right)_{-\alpha}$-basis
$\bar{\mathbf{P}}_{1}$.

In order to reach a contradiction we just need to show that $\tilde{\mathbf{P}}_{2}^{[2]}$
has a column with $\bar{s}$-degree less than that of the corresponding
column in $\bar{\mathbf{P}}_{2}$. Let $\tilde{\mathbf{w}}$ be the
first column of $\tilde{\mathbf{P}}_{2}$ with $\vec{s}$-degree less
than that of the corresponding column $\mathbf{w}$ in $\mathbf{E}\bar{\mathbf{P}}_{2}$
and let $\bar{\mathbf{w}}$ be the corresponding column in $\bar{\mathbf{P}}_{2}$.
By \prettyref{cor:P2Degree} $\deg_{\vec{s}}\mathbf{w}=\deg_{\bar{s}}\bar{\mathbf{w}}$.
Let $\tilde{\mathbf{w}}^{[2]}$ be the second form of $\mathbf{B}\tilde{\mathbf{w}}$,
which is a column in $\tilde{\mathbf{P}}_{2}^{[2]}$ corresponding
to the column $\bar{\mathbf{w}}$ in $\bar{\mathbf{P}}_{2}$. We know
that either $\deg_{\bar{s}}\tilde{\mathbf{w}}^{[2]}\le-\alpha$ or
$\deg_{\bar{s}}\tilde{\mathbf{w}}^{[2]}=\deg_{\vec{s}}\tilde{\mathbf{w}}$
by \prettyref{lem:degreeCorrespondence}, as $\mathbf{E}\tilde{\mathbf{w}}^{[2]}=\mathbf{E}(\mathbf{B}\tilde{\mathbf{w}}+\mathbf{A}\mathbf{u})=\tilde{\mathbf{w}}$.
In either case, $\deg_{\bar{s}}\tilde{\mathbf{w}}^{[2]}<\deg_{\bar{s}}\bar{\mathbf{w}}$,
as $\deg_{\bar{s}}\bar{\mathbf{w}}$ is greater than both $-\alpha$
and $\deg_{\vec{s}}\tilde{\mathbf{w}}$. Hence we have $[\bar{\mathbf{P}}_{1},\tilde{\mathbf{P}}_{2}^{[2]}]$
is another $\left(\bar{\mathbf{F}},\sigma,\bar{s}\right)$-basis with
lower $\bar{s}$-degrees than $\mathbf{\bar{P}}$, contradicting with
the minimality of $\bar{\mathbf{P}}$. 
\end{pf}

\subsection{Achieving Efficient Computation}

\prettyref{thm:correctHighDegreeElements} essentially tells us that
a high degree part of a $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis
can be determined by computing a $\left(\bar{\mathbf{F}},\sigma,\bar{s}\right)$-basis,
something we know can be done efficiently. Notice the parallel between
the situation here and in the earlier balanced shift case, where the
transformed problem also allows us to compute a partial $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis,
albeit a low degree part, in each iteration.

After a $\left(\bar{\mathbf{F}},\sigma,\bar{s}\right)$-basis, or
equivalently a high degree part of a $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis,
is computed, for the remaining problem of computing the remaining
basis elements, we can in fact reduce the dimension of the input $\mathbf{F}$
by removing some of its columns corresponding to the high shift entries. 
\begin{thm}
\label{thm:zeroHighShiftEntries}Suppose without loss of generality
that the entries of $\vec{s}$ are in non-decreasing order. Let $I$
be the index set containing the indices of entries $s_{i}$ in $\vec{s}$
such that $s_{i}\le-\alpha$. Let $\mathbf{F}_{I}$ be the columns
of $\mathbf{F}$ indexed by $I$. Then a $\left(\mathbf{F}_{I},\sigma,\vec{s}\right)_{-\alpha}$-basis
\textbf{$\mathbf{P}_{1}$} gives a $\left(\mathbf{F},\sigma,\vec{s}\right)_{-\alpha}$-basis
$\left[\mathbf{P}_{1}^{T},\mathbf{0}\right]^{T}$. 
\end{thm}
%The theorem follows from the following claim.
%\end{pf}
%\begin{claim}
%\label{cla:zeroHighShiftEntries}

\begin{pf}
For any $\mathbf{p}\in\mathbb{K}\left[x\right]^{n\times1}$ and $\deg_{\vec{s}}\mathbf{p}\le-\alpha$,
note that if the $i$th entry of the shift satisfies $s_{i}\le-\alpha$,
then the corresponding entry $p_{i}$ of $\mathbf{p}$ is zero. %\end{claim}
%\begin{pf}
Otherwise, if $p_{i}\ne0$ then the $\vec{s}$-degree of $\mathbf{p}$
is at least $s_{i}>-\alpha$, contradicting the assumption that the
$\vec{s}$-degree of $\mathbf{p}$ is lower than or equal to $-\alpha$. 
\end{pf}
Thus, these zero entries do not need to be considered in the remaining
problem of computing a $\left(\mathbf{F},\sigma,\vec{s}\right)_{-\alpha}$-basis.
As such the corresponding columns from the input matrix $\mathbf{F}$
can be removed. 
\begin{exmp}
Let us return to \prettyref{exm:unbalancedShift}. When the parameters
$\alpha=\beta=1$, after computing an element of a $(\mathbf{F},8,\vec{s})$-basis
with $\vec{s}$-degree $0$ that exceeds $-\alpha=-1$, the first
row of any $\left(\mathbf{F},\sigma,\vec{s}\right)_{-1}$-basis must
be zero by \prettyref{thm:zeroHighShiftEntries} (since the first
entry of $\vec{s}=[0,-3,-5,-6]$ is $0>-\alpha$). This is illustrated
by the $(\mathbf{F},8,\vec{s})$-basis $\mathbf{P}$ given in \prettyref{exm:unbalancedShift}.
This implies that the first column of $\mathbf{F}$ is not needed
in the subsequent computation of the remaining basis elements.\end{exmp}
\begin{cor}
\label{cor:numberBasisElements}If the shift $\vec{s}$ satisfies
condition \eqref{con:unbalancedCondition} and $c$ is a constant
greater than or equal to $1$, then a $\left(\mathbf{F},\sigma,\vec{s}\right)_{-cd}$-basis
has at most $n/c$ basis elements.\end{cor}
\begin{pf}
Since $d=m\sigma/n\ge-\sum_{i=1}^{n}s_{i}/n$ under condition \eqref{con:unbalancedCondition},
there cannot be more than $n/c$ entries of $\vec{s}$ less than or
equal to $-cd$. By \prettyref{thm:zeroHighShiftEntries}, the only
possible nonzero rows of a $\left(\mathbf{F},\sigma,\vec{s}\right)_{-cd}$-basis
are the ones corresponding to (with the same indices as) the shift
entries that are less than or equal to $-cd$. Hence there cannot
be more than $n/c$ nonzero rows and at most $n/c$ columns, as the
columns are linearly independent. 
\end{pf}
We now have a situation similar to that found in the balanced shift
case. Namely, for each iteration we transform the problem using appropriate
parameters $\alpha$ and $\beta$ to efficiently compute the basis
elements with degrees greater than $-\alpha$. Then we can remove
columns from the input matrix $\mathbf{F}$ corresponding to the shift
entries that are greater than $-\alpha$. We can then repeat the same
process again, with a larger $\alpha$ and $\beta$, in order to compute
more basis elements. 
\begin{thm}
If the shift $\vec{s}$ satisfies condition \eqref{con:unbalancedCondition},
then a $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis can be computed
with cost $O\left(n^{\omega}\bar{\M}(d)\log\sigma\right)=O(n^{\omega}d\log d\log\log d\log\sigma)\subset O^{\sim}(n^{\omega}d)$. \end{thm}
\begin{pf}
We give the following constructive proof. Initially, we set transformation
parameters $\alpha_{1}=\beta_{1}=2d$ with $d=m\sigma/n\ge-\sum_{i=1}^{n}s_{i}/n$.
\prettyref{alg:mab} works efficiently on the transformed problem
as the shift $\bar{s}^{\left(1\right)}$ is balanced and the dimension
of $\bar{\mathbf{F}}_{1}$ remains $O\left(n\right)$. By \prettyref{thm:correctHighDegreeElements}
this gives the basis elements of $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis
with $\vec{s}$-degree exceeding $-\alpha_{1}=-2d$. By \prettyref{cor:numberBasisElements},
the number of basis elements remaining to be computed is at most $n/2$,
hence the number of elements correctly computed is at least $n/2$.
By \prettyref{thm:zeroHighShiftEntries}, this also allows us to remove
at least half of the columns from the input $\mathbf{F}$ and correspondingly
at least half of the rows from the output for the remaining problem.
Thus the new input matrix $\mathbf{F}_{2}$ has a new column dimension
$n_{2}\le n/2$ and the corresponding shift $\vec{s}^{\left(2\right)}$
has $n_{2}$ entries. The average degree of the new problem is $d_{2}~=~m\sigma/n_{2}$.

For the second iteration, we set $\alpha_{2}$ and $\beta_{2}$ to
$2d_{2}$. Since \[
\alpha_{2}=2m\sigma/n_{2}\ge-2\sum_{i=1}^{n}s_{i}/n_{2}\ge-2\sum_{i=1}^{n_{2}}s_{i}^{\left(2\right)}/n_{2},\]
 this allows us to reduce the dimension $n_{3}$ of $\mathbf{F}_{3}$
to at most $n_{2}/2$ after finishing computing a $\left(\bar{\mathbf{F}}_{2},\sigma,\bar{s}^{\left(2\right)}\right)_{-\alpha_{1}}$-basis.
Again, this can be done using \prettyref{alg:mab} with a cost of
$O\left(n_{2}^{\omega}\bar{\M}(d_{2})\log\sigma\right)$ as the shift
$\bar{a}_{2}$ is balanced and the dimension of $\bar{\mathbf{F}}_{2}$
is $O\left(n_{2}\right)$. Repeating this process, at iteration $i$,
we set $\alpha_{i}=\beta_{i}=2d_{i}=2m\sigma/n_{i}$. The transformed
problem has a balanced shift $\bar{a}_{i}$ and column dimension $O\left(n_{i}\right)$.
So a $\left(\bar{\mathbf{F}}_{i},\sigma,\bar{s}^{\left(i\right)}\right)_{-\alpha_{i-1}}$-basis
can be computed with a cost of \[
O\left(n_{i}^{\omega}\bar{\M}\left(d_{i}\right)\log\sigma\right)\subset O\left(\left(2^{-i}n\right)^{\omega}\bar{\M}\left(2^{i}d\right)\log\sigma\right)\subset O\left(2^{-i}n^{\omega}\bar{\M}(d)\log\sigma\right).\]
 Since \[
\alpha_{i}=2m\sigma/n_{i}\ge-2\sum_{i=1}^{n}s_{i}/n_{i}\ge-2\sum_{i=1}^{n_{i}}s_{i}^{\left(i\right)}/n_{i},\]
 the column dimension $n_{i+1}$ of the next problem can again be
reduced by a half. After iteration $i$, at most $n/2^{i}$ $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis
elements remain to be computed. We can stop this process when the
column dimension $n_{i}$ of the input matrix $\mathbf{F}_{i}$ reaches
the row dimension $m$, as an order basis can be efficiently computed
in such case. Therefore, a complete $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis
can be computed in at most $\log(n/m)$ iterations, so the overall
cost is \[
O\left(\sum_{i=1}^{\log(n/m)}\left(2^{-i}n^{\omega}\bar{\M}(d)\log\sigma\right)\right)=O\left(n^{\omega}\bar{\M}(d)\log\sigma\sum_{i=1}^{\log(n/m)}2^{-i}\right)\subset O\left(n^{\omega}\bar{\M}(d)\log\sigma\right).\]
. 
\end{pf}
\input{algorithm2.tex} Finally, we remark that when the condition
\eqref{con:unbalancedCondition} is relaxed to $\sum_{i=1}^{n}-s_{i}\in O\left(m\sigma\right)$,
so that $\sum_{i=1}^{n}-s_{i}\le cm\sigma$ for a constant $c$, we
can still compute a $\left(\mathbf{F},\sigma,\vec{s}\right)$-basis
with the same complexity, by setting $\alpha_{i}=\beta_{i}=2cm\sigma/n_{i}$
at each iteration $i$ and following the same procedure as above.
The cost at each iteration $i$ remains $O^{\sim}\left(n^{\omega}d\right)$,
and the entire computation still uses at most $\log(n/m)$ iterations. 
